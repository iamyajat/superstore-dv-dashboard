---
title: "Superstore Dashboard"
author: "Rishu, Yajat & Yash"
date: '2022-04-22'
output: html_document
runtime: shiny
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DT)
library(plotly)
library(dplyr)
df = read.csv("./superstore.csv")
state_codes = read.csv("https://raw.githubusercontent.com/plotly/datasets/master/2011_us_ag_exports.csv")[,1:2]
```

### Lookup

```{r eruptions, echo=FALSE}
inputPanel(
  selectInput("cat", label = "Category:",
              choices = unique(df$Category), selected = "Office Supplies"),
  selectInput("typ", label = "Type:",
              choices = c("Sales", "Discount", "Profit"), selected = "Profit")
  
#  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
#              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlotly({
  df_cat = df %>% filter(Category == input$cat)
  df_cat = aggregate(df_cat[, 18:21], list(df_cat$State), mean)
  df_cat = merge(x=df_cat, y=state_codes, by.x= "Group.1", by.y = "state")
  df_cat$hover <- with(df_cat, paste(Group.1, "<br>Sales: ", round(Sales, digits = 2), 
                                     "<br>Discount: ", round(Discount, digits = 2), 
                                     "<br>Profits: ", round(Profit, digits = 2)
                                     ))
  l <- list(color = toRGB("white"), width = 2)
  g <- list(
    scope = 'usa',
    projection = list(type = 'albers usa')
  )
  fig <- plot_ly(type="choropleth", locations=df_cat$code, 
                 locationmode="USA-states", text = df_cat$hover,
                 z=df_cat[, c(input$typ)]) %>% layout(geo=g)
  fig <- fig %>% colorbar(title ="in USD")
  fig <- fig %>% layout(
    title = paste("Average", input$typ, "in", input$cat)
  )
  fig
})
```

### Another one
```{r, echo=FALSE}
inputPanel(
  selectInput("typ2", label = "Type:",
              choices = c("Ship.Mode", "Segment"), selected = "Ship.Mode")
)
renderPlotly({
  ship_mode_freq = data.frame(table(df[,c(input$typ2)]))
  fig <- plot_ly(ship_mode_freq, labels = ~Var1, values = ~Freq, type= "pie", textinfo='label+percent')
  # fig <- fig %>% add_pie(hole = 0.6)
  fig <- fig %>% layout(title = paste(input$typ2, 'of People'),
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
  fig
  })
```

### Another one
```{r, echo=FALSE}
df<- read.csv("./superstore.csv")
fig <- plot_ly(df[seq(1,50000,500),], x = ~df$Sales, y = ~df$Profit, z = ~df$Discount,
               marker = list(color = ~df$Quantity, colorscale = c('#FFE1A1', '#683531'), showscale = TRUE))
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis = list(title = 'Quantity'),
                                   yaxis = list(title = 'Sales'),
                                   zaxis = list(title = 'Profit')),
                      annotations = list(
                        x = 1,
                        y = 1,
                        text = 'Profits',
                        xref = 'paper',
                        yref = 'paper',
                        showarrow = FALSE
                      ),paper_bgcolor = '#FFFFFF',
                      plot_bgcolor = '#000000',
                      font = list(color = "#000000"))
fig
```

### Products vs Preferred Ship Modes
```{r,echo =FALSE}
dfstore<-read.csv("./superstore.csv")
dfstore%>%
  group_by(Sub.Category)%>%
  ggplot(aes(Sub.Category,fill=Ship.Mode))+
  geom_bar(position = 'fill')+
  scale_fill_manual(values = c("#DADAEB", "#9E9AC8", "#6A51A3","#301934"))+
  coord_flip()+
  labs(title='There is no prefered ship mode in different products',
       x='Proportion',
       y='Sub Category')+
  theme_bw()
```

### ANOTHER ANOTHER ONE
```{r, echo=FALSE}
suppressPlotlyMessage <- function(p) {
  suppressMessages(plotly_build(p))
}

fig <- suppressPlotlyMessage(plot_ly(data = df[seq(1,5000,50),], x = ~Sales, y = ~Profit,
               marker = list(size = 6,
                             color = 'rgba(255, 182, 193, .9)',
                             line = list(color = 'rgba(152, 0, 0, .8)',
                                         width = 1))))
fig <- fig %>% layout(title = 'Sales vs Profit',
         yaxis = list(zeroline = FALSE),
         xaxis = list(zeroline = FALSE))

fig
```

### TOP 5 CITIES PROFIT
```{r, echo=FALSE}
  df_city_agg = aggregate(df[, c("Profit")], list(df$City), sum)
  df_top5 = head(df_city_agg[order(df_city_agg$x, decreasing = TRUE),], n=5)

x <- df_top5$Group.1
y <- df_top5$x
text <- df_top5$Group.1
data <- data.frame(x, y, text)

fig <- plot_ly(data, x = ~x, y = ~y, type = 'bar', text = text,
        marker = list(color = 'rgb(235, 190, 209)',
                      line = list(color = 'rgb(232, 76, 134)',
                                  width = 1.5)))
fig <- fig %>% layout(title = "Top 5 Cities in Profit",
         xaxis = list(title = ""),
         yaxis = list(title = ""))

fig
```


