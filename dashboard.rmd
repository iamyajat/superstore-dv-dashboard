---
title: "Superstore Dashboard"
author: "Rishu, Yajat & Yash"
date: '2022-04-22'
output: html_document
runtime: shiny
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DT)
library(plotly)
library(dplyr)
df = read.csv("./superstore.csv")
state_codes = read.csv("https://raw.githubusercontent.com/plotly/datasets/master/2011_us_ag_exports.csv")[,1:2]
```

### Lookup

```{r eruptions, echo=FALSE}
inputPanel(
  selectInput("cat", label = "Category:",
              choices = unique(df$Category), selected = "Office Supplies"),
  selectInput("typ", label = "Type:",
              choices = c("Sales", "Discount", "Profit"), selected = "Profit")
  
#  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
#              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlotly({
  df_cat = df %>% filter(Category == input$cat)
  df_cat = aggregate(df_cat[, 18:21], list(df_cat$State), mean)
  df_cat = merge(x=df_cat, y=state_codes, by.x= "Group.1", by.y = "state")
  df_cat$hover <- with(df_cat, paste(Group.1, "<br>Sales: ", round(Sales, digits = 2), 
                                     "<br>Discount: ", round(Discount, digits = 2), 
                                     "<br>Profits: ", round(Profit, digits = 2)
                                     ))
  l <- list(color = toRGB("white"), width = 2)
  g <- list(
    scope = 'usa',
    projection = list(type = 'albers usa')
  )
  fig <- plot_ly(type="choropleth", locations=df_cat$code, 
                 locationmode="USA-states", text = df_cat$hover,
                 z=df_cat[, c(input$typ)]) %>% layout(geo=g)
  fig <- fig %>% colorbar(title ="in USD")
  fig <- fig %>% layout(
    title = paste("Average", input$typ, "in", input$cat)
  )
  fig
})
```

### Another one
```{r, echo=FALSE}
inputPanel(
  selectInput("typ2", label = "Type:",
              choices = c("Ship.Mode", "Segment"), selected = "Ship.Mode")
)
renderPlotly({
  ship_mode_freq = data.frame(table(df[,c(input$typ2)]))
  fig <- plot_ly(ship_mode_freq, labels = ~Var1, values = ~Freq, type= "pie", textinfo='label+percent')
  # fig <- fig %>% add_pie(hole = 0.6)
  fig <- fig %>% layout(title = paste(input$typ2, 'of People'),
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
  fig
  })
```

### Another one
```{r, echo=FALSE}
supdata<- read.csv("./superstore.csv")
fig <- plot_ly(supdata[1:50,], x = ~supdata$Sales, y = ~supdata$Profit, z = ~supdata$Discount,
               marker = list(color = ~supdata$Quantity, colorscale = c('#FFE1A1', '#683531'), showscale = TRUE))
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis = list(title = 'Quantity'),
                                   yaxis = list(title = 'Sales'),
                                   zaxis = list(title = 'Profit')),
                      annotations = list(
                        x = 1,
                        y = 0.5,
                        text = 'Profits',
                        xref = 'paper',
                        yref = 'paper',
                        showarrow = FALSE
                      ),paper_bgcolor = '#000000',
                      plot_bgcolor = '#000000',
                      font = list(color = "#ffffff"))
fig
```
## Embedded Application

It's also possible to embed an entire Shiny application within an R Markdown document using the `shinyAppDir` function. This example embeds a Shiny application located in another directory:

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)
```

Note the use of the `height` parameter to determine how much vertical space the embedded application should occupy.

You can also use the `shinyApp` function to define an application inline rather then in an external directory.

In all of R code chunks above the `echo = FALSE` attribute is used. This is to prevent the R code within the chunk from rendering in the document alongside the Shiny components.



